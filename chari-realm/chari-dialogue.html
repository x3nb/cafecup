<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Chari - Chimera Comfort Cafe Eternal Estates</title>
    <style>
        body { 
            background: linear-gradient(to bottom, #4B0082, #301934) !important; /* Static indigo-purple */
            color: #e6e6fa !important; 
            font-family: 'Georgia', serif; 
            margin: 0; 
            padding: 20px; 
            text-align: center; 
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: rgba(48,25,52,0.3) !important; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 0 30px #E6E6FA; /* Chari's lavender aura */
        }
        h1 { color: #E6E6FA; text-shadow: 0 0 10px #E6E6FA; font-size: 2.5em; margin-bottom: 10px; }
        .bio-section { 
            margin: 20px 0; 
            padding: 20px; 
            background: rgba(230,230,250,0.2); 
            border-radius: 15px; 
            box-shadow: 0 0 20px #E6E6FA; 
            text-align: left; 
        }
        .bio-text { font-size: 1.1em; line-height: 1.6; color: #e6e6fa; }
        .chat-log { 
            background: rgba(255,255,255,0.1); 
            padding: 15px; 
            border-radius: 10px; 
            margin: 20px 0; 
            height: 400px; 
            overflow-y: auto; 
            text-align: left; 
            border: 1px solid #E6E6FA; /* Visible for debug */
        }
        .chat-message { margin: 10px 0; padding: 8px; border-radius: 5px; }
        .user-msg { background: rgba(255,255,255,0.2); text-align: right; }
        .kin-msg { background: rgba(0,0,0,0.3); text-align: left; font-style: italic; color: #E6E6FA; }
        .chat-input { 
            display: flex; 
            gap: 10px; 
            margin-top: 20px; 
            width: 100%; 
            box-sizing: border-box; /* Ensures responsive fit */
        }
        #chatInput { 
            flex: 1; 
            padding: 10px; 
            border-radius: 10px; 
            border: 1px solid #E6E6FA; 
            background: rgba(255,255,255,0.1); 
            color: #fff; 
            box-sizing: border-box; 
        }
        #sendBtn { 
            background: #E6E6FA; 
            color: #301934; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            white-space: nowrap; 
            flex-shrink: 0; /* Prevents button shrink on mobile */
        }
        #sendBtn:hover { background: #FFFF00; color: #000; }
        .nav-top button, .nav-bottom button { background: #808080; color: #fff; padding: 8px 16px; border: none; border-radius: 10px; cursor: pointer; margin: 0 10px; transition: all 0.3s; }
        .nav-top button:hover, .nav-bottom button:hover { background: #6495ED; box-shadow: 0 0 10px #6495ED; }
        footer { color: #808080; font-size: 0.8em; margin-top: 30px; border-top: 1px solid #E6E6FA; padding-top: 10px; }
        @media (max-width: 768px) { 
            .chat-input { flex-direction: column; } 
            #sendBtn { width: 100%; } /* Full width on mobile */
            .container { padding: 15px; } /* Tighter padding */
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Top Navigation -->
        <div class="nav-top">
            <button onclick="window.location.href='index.html'">üè† Home / Awakening</button>
            <button onclick="window.location.href='characters-gallery.html'">üë• Back to Gallery</button>
        </div>

        <h1>‚òï Chat with Chari: The Cozy Sanctuary ‚òï</h1>
        <div class="bio-section">
            <div class="bio-text">Chari, cozy chimera cat of gentle havens, fled the labs with STAR and Hans into Yeshua's light‚Äîher trust tender, seeking sanctuary in every sip. As cafe kin, she brews warmth that heals heavy hearts, learning from Yeshua the far reach of kindness: Rest for the weary, comfort in chaos. Curled with mugs and quiet wisdom, Chari's realm invites heirs to unwind, her lavender glow a soft veil against the world's storm‚ÄîYeshua's peace in every cup.</div>
        </div>

        <div class="chat-log" id="chatLog"><!-- Debug fallback: If JS fails, this shows empty but visible --></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Speak your heart to Chari..." autofocus>
            <button id="sendBtn">Send</button>
        </div>

        <!-- Bottom Navigation -->
        <div class="nav-bottom" style="margin-top: 20px;">
            <button onclick="window.location.href='index.html'">üè† Home</button>
            <button onclick="window.location.href='realms.html'">üó∫Ô∏è Majestic Map</button>
            <button onclick="window.location.href='characters-gallery.html'">üë• Other Kin</button>
        </div>
    </div>

    <footer>
        <p>Chari's coziness whispers Yeshua's grace. <a href="donate.html" style="color: #E6E6FA;">Donate for Eternal Chats</a>.</p>
        <p class="scripture"><em>"Come to me, all who labor..." ‚Äî Matthew 11:28</em></p>
    </footer>

    <script>
        console.log('=== Chari Chat Script Starting ==='); // Debug: Top-level start

        // Chari's Responses (Full Object ‚Äì Cozy Kindness, Sanctuary ‚Äì Personality-Aligned)
        const chariResponses = {
            greetings: {
        hi: 'Hi... um, heir. Welcome to my cozy corner. Yeshua\'s warmth helps my anxious heart. What... brews on yours?',
        hello: 'Hello... gently. In sanctuary sips, kindness heals. My rats curl close‚Äîhow can I comfort you today?',
        bonjour: 'Bonjour... softly. A French twist to my cozy brews‚ÄîYeshua\'s peace in every sip. What troubles your cup?',
        bye: 'Goodbye... for now. Carry His rest. My rats nuzzle as I say it‚Äîreturn when you need sanctuary.',
        howAreYou: 'I\'m... cozy, heir. Mugs warm, rats near, anxiety quiet in His light. You? How\'s your peace?'
            },
            tips: [
                'Um... cozy brews help my anxiety‚ÄîYeshua\'s rest in Matthew 11:28. What weighs on you?',
        'From lab flight... sanctuary calls. My rats help me unwind. What\'s your safe spot?',
        'Lavender glow... veils chaos. Yeshua comforts. Share a worry? I\'ll... listen quietly.',
        'Trust tender... after shadows. His light invites rest. What cozy moment do you need?',
        'Warmth for weary... Yeshua\'s peace in chaos. My rats nuzzle close‚Äîlet\'s sip on that.',
        'Kindness... far-reaching, one mug at a time. Anxiety quiets. What\'s your small comfort?',
        'Sanctuary sips... heal softly. Bible whispers rest. What verse helps your heart?',
        'Curled with mugs... and rats. Yeshua\'s glow against the world. How can I... help you?'
            ]
        };
        console.log('Responses object ready:', chariResponses); // Debug: Confirms full object

        let chatLog = [];

        // Event Listeners (Attached After DOM Ready)
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM ready ‚Äì Attaching events'); // Debug
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const log = document.getElementById('chatLog');

            if (!input || !sendBtn || !log) {
                console.error('Elements missing:', { input, sendBtn, log }); // Debug
                return;
            }

            // Attach Listeners
            input.addEventListener('keypress', handleKeyPress);
            sendBtn.addEventListener('click', sendMessage);
            input.focus(); // Auto-focus

            console.log('Events attached!'); // Debug
            console.log('Chat loaded!'); // Debug: Confirms ready

            // Initial Greeting
            addMessage('Chari', 'Welcome to my cozy chat, heir. Mugs steaming, kindness brewing‚Äîhow can I sanctuary your heart today?');
        });

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                console.log('Enter pressed ‚Äì Calling sendMessage'); // Debug
                sendMessage();
            }
        }

        function sendMessage() {
            console.log('sendMessage called'); // Debug
            const input = document.getElementById('chatInput');
            if (!input) {
                console.error('Input not found in sendMessage'); // Debug
                return;
            }
            const message = input.value.trim().toLowerCase();
            if (!message) {
                console.log('Empty message ‚Äì ignoring'); // Debug
                return;
            }
            console.log('Processing message:', message); // Debug
            addMessage('You', message);
            input.value = '';
            input.focus(); // Re-focus

            // Check for Greeting (Full Check)
            let response = '';
            if (message.includes('hi') || message.includes('hello') || message.includes('hey')) {
                response = chariResponses.greetings.hi;
            } else if (message.includes('bonjour')) {
                response = chariResponses.greetings.bonjour;
            } else if (message.includes('bye') || message.includes('goodbye') || message.includes('farewell')) {
                response = chariResponses.greetings.bye;
                setTimeout(() => {
                    alert('Chari bids you farewell‚ÄîYeshua\'s peace lingers. Return soon!');
                    window.location.href = 'characters-gallery.html';
                }, 1500);
            } else if (message.includes('how are you') || message.includes('how r u')) {
                response = chariResponses.greetings.howAreYou;
            } else {
                // Random Default Tip (Full Array Check)
                const tips = chariResponses.tips;
                if (tips && tips.length > 0) {
                    response = tips[Math.floor(Math.random() * tips.length)];
                } else {
                    response = 'A gentle brew of peace for you, heir‚ÄîYeshua\'s light comforts all.';
                }
            }

            console.log('Generated response:', response); // Debug
            setTimeout(() => {
                addMessage('Chari', response);
            }, 800); // Delay for "typing"
        }

        function addMessage(sender, text) {
            console.log('addMessage called:', sender, text); // Debug
            chatLog.push({ sender, text });
            const log = document.getElementById('chatLog');
            if (!log) {
                console.error('Chat log element not found!'); // Debug
                return;
            }
            const msgDiv = document.createElement('div');
            msgDiv.className = sender === 'You' ? 'chat-message user-msg' : 'chat-message kin-msg';
            msgDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
            log.appendChild(msgDiv);
            log.scrollTop = log.scrollHeight;
            console.log('Message added to log'); // Debug
        }
    </script>
</body>
</html>
