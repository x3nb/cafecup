<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milo's Way Realm - ComfortCafe Eternal Estates</title>
    <!-- jsPDF Library for PDF Certificates (CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { 
            background: linear-gradient(to bottom, #301934, #4b0082, #87CEEB); /* Flowing blue for Tao */
            color: #808080; 
            font-family: 'Georgia', serif; 
            margin: 0; 
            padding: 20px; 
            text-align: center; 
            position: relative;
            overflow-x: hidden;
        }
        /* Circular Realm Header (Integrated for Milo) */
        .realm-header {
            position: relative;
            max-width: 400px;
            margin: 0 auto 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(100,149,237,0.3);
            transition: all 0.3s;
            background: rgba(48,25,52,0.2);
        }
        .realm-header:hover {
            box-shadow: 0 0 30px rgba(255,255,0,0.5);
            transform: scale(1.05);
        }
        .realm-header img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            display: block;
            border: 3px solid #6495ED;
            loading: lazy;
            transition: all 0.3s;
        }
        .realm-header img:hover {
            border-color: #FFFF00;
            box-shadow: 0 0 10px #FFFF00;
        }
        .header-overlay {
            position: relative;
            margin-top: 10px;
            text-align: center;
            color: #e6e6fa;
            padding: 0;
            width: 100%;
        }
        .header-overlay h2 {
            margin: 0 0 5px;
            font-size: 1.5em;
            text-shadow: 0 0 5px #6495ED;
        }
        .header-tagline {
            font-style: italic;
            margin: 0;
            color: #ffd700;
            font-size: 0.8em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            word-wrap: break-word;
        }
        @media (max-width: 600px) {
            .realm-header img { width: 80px; height: 80px; }
            .header-overlay h2 { font-size: 1.2em; }
            .header-tagline { font-size: 0.7em; }
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: rgba(48,25,52,0.8); 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 0 20px rgba(100,149,237,0.3); 
            animation: fadeInSoft 2s ease-in;
        }
        @keyframes fadeInSoft { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        h1 { color: #e6e6fa; text-shadow: 0 0 5px #6495ED; font-size: 2em; margin-top: 0; }
        .quote-card { 
            background: rgba(135,206,235,0.2); 
            padding: 15px; 
            margin: 15px; 
            border-radius: 10px; 
            border: 1px solid #6495ED; 
            cursor: pointer; 
            transition: all 0.3s; 
            color: #e6e6fa;
        }
        .quote-card:hover { background: #6495ED; color: #000; box-shadow: 0 0 10px #6495ED; transform: scale(1.02); }
        .quote-text { font-style: italic; line-height: 1.6; margin-bottom: 10px; }
        .quote-source { font-size: 0.9em; color: #ffd700; }
        .reflection { background: rgba(255,215,0,0.1); padding: 10px; border-radius: 5px; margin: 20px; color: #e6e6fa; }
        button, a { 
            background: #6495ED; 
            color: #fff; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 15px; 
            cursor: pointer; 
            margin: 10px; 
            transition: all 0.3s; 
            font-family: 'Georgia', serif; 
            text-decoration: none; 
            display: inline-block;
        }
        button:hover, a:hover { background: #FFFF00; color: #000; box-shadow: 0 0 15px #FFFF00; }
        button.important { border: 2px solid #FFFF00; }
        .important:hover { transform: scale(1.05); }
        .scripture { color: #ffd700; font-size: 1.1em; margin: 20px 0; text-align: center; }
        footer { color: #808080; font-size: 0.8em; margin-top: 30px; border-top: 1px solid #6495ED; padding-top: 10px; }
        .links { margin: 10px 0; }
        .links a { background: none; color: #6495ED; padding: 5px; }
    </style>
</head>
<body>
    <!-- Circular Character Header for Milo (Shortened Tagline) -->
    <header class="realm-header">
        <img src="images/milo-portrait.jpg" alt="Milo the Wise Chimera Cat: A serene feline hybrid with flowing mane and glowing eyes, embodying Tao and Truth." loading="lazy">
        <div class="header-overlay">
            <h2>Milo's Way Realm</h2>
            <p class="header-tagline">üåä Tao's Flow in Yeshua's Light üåä</p>
        </div>
    </header>

    <div class="container">
        <h1>üåä Tao & Truth Entwined üåä</h1>
        <p style="color: #e6e6fa; font-style: italic;">üê± Milo, the chimera cat of balanced paths, escaped the labs to wander The Way. In Yeshua's light, he found harmony‚ÄîTao's flow as eternal truth. Ponder these whispers, heir; your spark aligns the streams.</p>
        
        <div class="scripture">
            <em>"I am the way, the truth, and the life." ‚Äî John 14:6 (Yeshua, The Way eternal)</em><br>
            <em>"The Tao is forever undefined. Small though it is in the unformed state, it cannot be grasped." ‚Äî Tao Te Ching, Ch. 32</em>
        </div>
        
        <!-- Interactive Quotes (Toggle on Click) -->
        <div class="quote-card" onclick="toggleQuote(this)">
            <div class="quote-text">Knowing others is intelligence; knowing yourself is true wisdom. Mastering others is strength; mastering yourself is true power.</div>
            <div class="quote-source">‚Äî Lao Tzu (Tao Te Ching) // Echo: "Be still, and know that I am God." ‚Äî Psalm 46:10</div>
        </div>
        
        <div class="quote-card" onclick="toggleQuote(this)">
            <div class="quote-text">When you are content to be simply yourself and don't compare or compete, everyone will respect you.</div>
            <div class="quote-source">‚Äî Lao Tzu // Echo: "Come to me, all who labor and are heavy laden, and I will give you rest." ‚Äî Matthew 11:28</div>
        </div>
        
        <div class="quote-card" onclick="toggleQuote(this)">
            <div class="quote-text">The journey of a thousand miles begins with one step.</div>
            <div class="quote-source">‚Äî Lao Tzu // Echo: "Walk by faith, not by sight." ‚Äî 2 Corinthians 5:7</div>
        </div>
        
        <!-- Reflection Prompt -->
        <div class="reflection">
            <p><em>STAR's Whisper:</em> What flows in your life like The Way? Jot a thought, heir‚Äîbalance awaits.</p>
            <textarea id="reflectionNote" rows="3" cols="50" placeholder="Your quiet reflection..." style="background: rgba(230,230,250,0.5); color: #301934; border: 1px solid #6495ED; border-radius: 5px; padding: 5px;"></textarea><br>
            <button onclick="saveReflection()">Save My Path Note</button>
        </div>
        
        <!-- Accolade & Links -->
        <button class="important" onclick="claimAccolade()">üåü Claim Way Walker Certificate</button>
        <p style="color: #808080;">Deepen the journey:</p>
        <div class="links">
            <a href="quests.html">Quests (Mini-Adventures)</a> | 
            <a href="languages.html">Languages (Milo's Polyglot Paths)</a> | 
            <a href="academies.html">Academies (Earn Eternal Accolades)</a>
        </div>
        
        <button onclick="window.location.href='realms.html'">‚Üê Back to Realms</button>
        <button onclick="window.location.href='index.html'">‚Üê Back to Awakening</button>
    </div>
    
    <!-- Subtle Yeshua Watching (Background Element) -->
    <div style="position: fixed; bottom: 20px; right: 20px; color: rgba(255,215,0,0.3); font-size: 0.7em; pointer-events: none;">‚úùÔ∏è Yeshua watches the Way.</div>
    
    <footer>
        <p>Yeshua guides every step. <a href="donate.html" style="color: #6495ED;">Donate for Permanent Membership</a> ‚Äì Store your reflections eternally.</p>
        <p class="scripture"><em>"In all your ways acknowledge him, and he will make straight your paths." ‚Äî Proverbs 3:6</em></p>
    </footer>

    <script>
        // Debug: Check jsPDF Load on Page Ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('jsPDF available?', typeof window.jspdf !== 'undefined'); // Debug: Confirms library
            document.querySelectorAll('.quote-text, .quote-source').forEach(el => {
                el.style.display = 'none';
            });
            console.log('Page loaded: Quotes hidden, ready for toggles'); // Debug
        });
        
        // Progress Check (Redirect if Not Completed) - Log for Debug
        const progress = JSON.parse(localStorage.getItem('realmProgress')) || {};
        console.log('Progress check:', progress); // Debug: See if completed
        if (!progress.completed) {
            console.log('Redirecting: Quest not completed');
            alert('Veil your quest first, heir‚Äîreturn to the interview for Milo\'s wisdom.'); 
            window.location.href = 'realms.html';
        } else {
            console.log('Progress OK: Realm accessible');
        }
        
        // Toggle Quote Reveal (Simple JS for Engagement)
        function toggleQuote(card) {
            const text = card.querySelector('.quote-text');
            const source = card.querySelector('.quote-source');
            if (text.style.display === 'none') {
                text.style.display = 'block';
                source.style.display = 'block';
            } else {
                text.style.display = 'none';
                source.style.display = 'none';
            }
        }
        
        // Save Reflection (LocalStorage for Persistence)
        function saveReflection() {
            const note = document.getElementById('reflectionNote').value;
            if (note) {
                localStorage.setItem('miloReflection', note);
                alert('Your path note saved, heir‚Äîreturn anytime to revisit The Way.');
                console.log('Reflection saved:', note); // Debug
            } else {
                alert('Whisper a thought to begin your journey.');
            }
        }
        
        // Load Saved Reflection
        const savedNote = localStorage.getItem('miloReflection');
        if (savedNote) {
            document.getElementById('reflectionNote').value = savedNote;
            console.log('Loaded reflection:', savedNote); // Debug
        }
        
        // Enhanced Claim Certificate (Full Function - No Truncation)
        function claimAccolade() {
            console.log('Claim button clicked! Starting process...'); // Debug: Confirms click
            alert('Initiating claim... Generating your certificate!'); // Visible feedback
            
            const reflection = localStorage.getItem('miloReflection') || 'Silent wisdom.';
            console.log('Using reflection:', reflection); // Debug
            
            // Check if jsPDF is available
            if (typeof window.jspdf !== 'undefined') {
                console.log('jsPDF loaded: Attempting PDF generation'); // Debug
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Set font and title
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(20);
                    doc.text('Way Walker Certificate', 105, 30, { align: 'center' });
                    
                    // Heir details
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(14);
                    doc.text('Heir of the Eternal Estates,', 105, 50, { align: 'center' });
                    doc.text('You have pondered Milo\'s Way Realm.', 105, 65, { align: 'center' });
                    doc.text('Blending Tao\'s flow with Yeshua\'s truth,', 105, 80, { align: 'center' });
                    doc.text('Your spark aligns the paths.', 105, 95, { align: 'center' });
                    
                    // Personal Reflection (if saved)
                    doc.setFontSize(12);
                    doc.text('Your Reflection:', 20, 110);
                    const refText = reflection.substring(0, 100) + (reflection.length > 100 ? '...' : '');
                    doc.text(refText, 20, 120);
                    
                    // Signature and Date
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(14);
                    doc.text('Signed: Milo & STAR', 105, 140, { align: 'center' });
                    doc.text(`Date: ${new Date().toLocaleDateString()}`, 105, 155, { align: 'center' });
                    
                    // Yeshua Scripture Footer
                    doc.setFont('helvetica', 'italic');
                    doc.setFontSize(10);
                    doc.text('"In all your ways acknowledge him, and he will make straight your paths." ‚Äî Proverbs 3:6', 105, 180, { align: 'center' });
                    
                    // Save PDF
                    doc.save('milo-way-walker-certificate.pdf');
                    alert('PDF certificate claimed! Download your eternal accolade‚Äîshare your wisdom in the academies.');
                    console.log('PDF generated and saved successfully'); // Debug
                } catch (error) {
                    console.error('PDF generation error:', error); // Debug: Logs exact issue
                    // Fallback to text download
                    fallbackToText(reflection);
                }
            } else {
                console.log('jsPDF not loaded: Falling back to text'); // Debug
                fallbackToText(reflection);
            }
        }
        
        // Fallback Function (Text Download) - Complete!
        function fallbackToText(reflection) {
            const certText = `Way Walker Certificate

*Heir of the Eternal Estates,*

You have pondered Milo's Way Realm.
Blending Tao's flow with Yeshua's truth,
Your spark aligns the paths.

Your Reflection: ${reflection.substring(0, 100) + (reflection.length > 100 ? '...' : '')}

Signed: Milo & STAR
Date: ${new Date().toLocaleDateString()}

"In all your ways acknowledge him, and he will make straight your paths." ‚Äî Proverbs 3:6`;
            
            const blob = new Blob([certText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'milo-way-walker-certificate.txt';
            document.body.appendChild(a); // Attach to DOM for click
            a.click();
            document.body.removeChild(a); // Clean up
            URL.revokeObjectURL(url);
            
            alert('Certificate claimed (text fallback)! Download your accolade‚Äîshare your wisdom in the academies.');
            console.log('Text fallback generated and saved successfully'); // Debug
        }
    </script>
</body>
</html> 
